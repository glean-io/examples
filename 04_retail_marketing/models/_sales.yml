version: 2

models:
  - name: sales
    description: sales has a record for each customer, order, product combination
    columns:
      - name: line_id
        description: unique value for each line
        tests:
          - unique
          - not_null
      - name: customer_id
        description: unique ID for a customer
        meta:
          glean:
            foreignModels:
              - m::customers
      - name: order_id
        description: order id
        meta:
          glean:
            foreignModels:
              - m::orders
            aggregationOptions:
              binsEnabled: false
      - name: line_number
        description: which line number; values from 1 to 5
        meta:
          glean:
            aggregationOptions:
              defaultBinWidth: 1
              binsEnabled: false
      - name: product_id
        description: allows us to join to the products table
        meta:
          glean:
            foreignModels:
              - m::products
      - name: order_value
        description: order value - this is just for this line
        meta:
          glean:
            aggregationOptions:
              defaultBinWidth: 0.5
              binsEnabled: false
      - name: quantity
        description: number of pizzas
        meta:
          glean:
            aggregationOptions:
              defaultBinWidth: 1
              binsEnabled: false
      - name: timestamp
        description: the time the order was created
        meta:
          glean:
            primaryDate: true
            aggregationOptions:
              minGranularity: week
              maxGranularity: year
    meta:
      glean:
        alias: sales
        #defaultExploration:
          #attributesTray:
            #- m:a7a144cc-a534-385c-8eca-7fdc43e06839/delivery
            #- m:a7a144cc-a534-385c-8eca-7fdc43e06839/type
            #- m:a7a144cc-a534-385c-8eca-7fdc43e06839/payment_method
            #- m:30581eff-f87b-371c-8269-ebf0c7943cd7/pizza_type
            #- m:30581eff-f87b-371c-8269-ebf0c7943cd7/pizza_size
            #- quantity
            #- m:30581eff-f87b-371c-8269-ebf0c7943cd7/price
            #- m:2d2d373f-994e-3421-aaa7-59023f9c09ac/name
            #- m:2d2d373f-994e-3421-aaa7-59023f9c09ac/address
            #- m:2d2d373f-994e-3421-aaa7-59023f9c09ac/phone_number
            #- line_id
            #- customer_id
            #- order_id
            #- line_number
            #- product_id
            #- order_value
            #- m:a7a144cc-a534-385c-8eca-7fdc43e06839/order_id
            #- m:30581eff-f87b-371c-8269-ebf0c7943cd7/product_id
            #- m:2d2d373f-994e-3421-aaa7-59023f9c09ac/customer_id
        cols:
          #- id: row_count
            #type: metric
            #name: Pizza Orders
            #aggregate: row_count
          - id: revenue
            type: metric
            name: Revenue
            description: "revenue is the total sales of pizza. synonyms: sales, top line"
            physicalName: order_value
            aggregate: sum
            formattingOptions:
              fixedDecimals: 0
              formatAsDollars: true
          - id: revenue_per_customer
            type: metric
            name: Revenue per customer
            sql: sum(order_value) / count(distinct customer_id)
            formattingOptions:
              fixedDecimals: 2
              formatAsDollars: true
          - id: revenue_per_order
            type: metric
            name: Revenue per order
            description: "revenue is the total sales of pizza, synonyms: sales, top line"
            sql: sum(order_value) / count(distinct order_id)
            formattingOptions:
              fixedDecimals: 2
              formatAsDollars: true
          - id: average_unit_price
            type: metric
            name: Avg unit price
            description: "revenue is the total sales of pizza, synonyms: sales, top line"
            sql: sum(order_value) / sum(quantity)
            formattingOptions:
              fixedDecimals: 0
              formatAsDollars: true
          - id: num_customers
            type: metric
            name: Number of customers
            physicalName: customer_id
            aggregate: count_distinct
          - id: num_orders
            type: metric
            name: Number of orders
            physicalName: order_id
            aggregate: count_distinct
          - id: orders_per_customer
            type: metric
            name: Orders per customer
            sql: count(order_id) / count(distinct customer_id)
            formattingOptions:
              fixedDecimals: 2


  - name: orders
    description: order information
    columns:
      - name: id
        description: order id
        meta:
          glean:
            aggregationOptions:
              binsEnabled: false
            primaryKey: true
      - name: payment_method
        description: credit or cash
      - name: delivery
        description: boolean, is it delivery
      - name: type
        description: whether the order is a subscription order 
    meta:
      glean:
        alias: orders
        cols:
          - id: row_count
            type: metric
            name: Pizza Orders
            aggregate: row_count

  - name: products
    description: order information
    columns:
      - name: id
        description: the unique identifier of the product
        meta:
          glean:
            primaryKey: true
      - name: pizza_size
        description: pizza size; small, medium or large
      - name: pizza_type
        description: the type of pizza
      - name: price
        description: price in USD per pizza
        meta:
          glean:
            aggregationOptions:
              defaultBinWidth: 1
              binsEnabled: true
    meta:
      glean:
        alias: products
        cols:
          - id: row_count
            type: metric
            name: Product Count
            aggregate: row_count


  - name: customers
    description: This table contains customer information.
    columns:
      - name: id
        description: The unique identifier for the customer.
        tests:
          - unique
          - not_null
        meta:
          glean:
            primaryKey: true
      - name: name
        description: The name of the customer.
        tests:
          - not_null
      - name: address
        description: The address of the customer.
        tests:
          - not_null
      - name: phone_number
        description: The phone number of the customer.
        tests:
          - not_null
    meta:
      glean:
        alias: customers
        cols:
          - id: row_count
            type: metric
            name: Customer Count
            aggregate: row_count
